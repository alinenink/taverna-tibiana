<!-- Fundo total com apar√™ncia de pergaminho medieval -->
<div class="svg-loader-overlay" *ngIf="carregando">
  <div class="svg-loader">
    <svg
      fill="#000000"
      height="200px"
      width="200px"
      version="1.1"
      id="Capa_1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 452.022 452.022"
      xml:space="preserve"
    >
      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
      <g
        id="SVGRepo_tracerCarrier"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></g>
      <g id="SVGRepo_iconCarrier">
        <path
          d="M440.761,380.351l-50.512-50.512l24.481-24.481c3.905-3.905,3.905-10.237,0-14.143c-3.905-3.904-10.237-3.904-14.143,0 l-9.494,9.494l-42.368-42.368c6.562-23.401,9.894-47.59,9.894-72l-0.001-153.69c0-4.777-3.379-8.887-8.065-9.811 c-113.629-22.402-228.859-22.402-342.488,0C3.379,23.764,0,27.875,0,32.652v153.69c0,55.105,16.721,108.08,48.356,153.2 c31.635,45.119,75.739,78.897,127.545,97.681c1.101,0.399,2.255,0.599,3.409,0.599c1.154,0,2.308-0.2,3.41-0.599 c40.392-14.651,76.722-38.923,105.694-70.5l18.334,18.334l-9.494,9.494c-3.905,3.905-3.905,10.237,0,14.143 c1.953,1.953,4.512,2.929,7.071,2.929c2.559,0,5.119-0.977,7.071-2.929l24.481-24.481l50.512,50.512 c7.262,7.261,16.917,11.26,27.187,11.26s19.924-3.999,27.186-11.26c7.262-7.262,11.261-16.917,11.261-27.186 C452.022,397.268,448.023,387.613,440.761,380.351z M359.946,331.858l-3.954,3.954L162.901,142.72l45.434,3.515l168.616,168.617 L359.946,331.858z M303.621,186.342c0,8.507-0.522,16.987-1.523,25.371l-82.234-82.234c-1.687-1.687-3.921-2.715-6.3-2.899 l-76.09-5.886c-2.916-0.229-5.777,0.833-7.842,2.899c-2.065,2.065-3.124,4.93-2.899,7.842l5.886,76.09 c0.184,2.379,1.212,4.613,2.899,6.3L249.48,327.788c-19.637,21.998-43.181,39.294-70.167,51.487 c-34.45-15.596-64.093-40.179-85.924-71.304C68.275,272.143,55,230.084,55,186.342l0-110.473c82.527-15.788,166.093-15.788,248.62,0 V186.342z M179.309,417.156c-46.45-17.606-86.009-48.352-114.577-89.097C35.468,286.322,20,237.317,20,186.342l0-145.43 c105.764-19.83,212.856-19.83,318.62,0v145.43c0,18.764-2.131,37.386-6.331,55.563l-12.648-12.648 c2.637-14.044,3.979-28.452,3.979-42.915l-0.001-118.69c0-4.753-3.346-8.849-8.003-9.798c-90.445-18.438-182.167-18.438-272.614,0 C38.345,58.802,35,62.899,35,67.652v118.69c0,47.872,14.527,93.9,42.013,133.112c24.797,35.354,58.809,62.997,98.359,79.939 c1.257,0.539,2.597,0.808,3.938,0.808c1.34,0,2.68-0.269,3.937-0.808c31.01-13.282,57.997-32.593,80.394-57.444l10.618,10.618 C248.179,381.194,215.58,403.39,179.309,417.156z M152.273,202.297l-3.514-45.434l193.091,193.091l-20.96,20.959L152.273,202.297z M376.107,343.981l6.336,6.336l-15.345,36.829l-17.078-17.078L376.107,343.981z M382.392,402.44l15.345-36.829l11.178,11.178 l-15.345,36.829L382.392,402.44z M426.619,420.58L426.619,420.58c-3.483,3.484-8.116,5.403-13.043,5.403 c-1.141,0-2.262-0.114-3.361-0.315l13.994-33.585l2.41,2.41c3.484,3.484,5.403,8.116,5.403,13.043S430.103,417.096,426.619,420.58z"
        ></path>
      </g>
    </svg>
  </div>
</div>

<div class="parchment-background">
  <div class="consulta-layout">
    <h1 class="tavernatibiana-title">Sempre Come√ßa na Taverna</h1>

    <p class="consulta-intro">
      Aqui na nossa humilde taverna, os destinos se revelam a quem ousa
      procur√°-los. Insira o ID do seu her√≥i e descubra o que falta para alcan√ßar
      a gl√≥ria e se tornar um
      <span class="highlight">charlover supremo</span>!
    </p>

    <!-- Formul√°rio de Consulta -->
    <form class="parchment-card" (submit)="consultarPersonagem()">
      <button class="voltar-button-card" [routerLink]="'/home'">Voltar</button>
      <h2>üîç Consulta de Personagem</h2>
      <hr />
      <div class="input-icon-group">
        <input
          type="text"
          id="char-id"
          placeholder="Ex: 123456"
          [(ngModel)]="characterId"
          name="characterId"
        />
      </div>
      <button type="submit">Consultar</button>
    </form>

    <!-- Registro dos Feitos do Her√≥i -->
    <div class="parchment-card" *ngIf="characterData">
      <h2>üìú Jornada do Aventureiro üìú</h2>
      <hr />

      <ul>
        <li>
          <img src="assets/id-card.svg" alt="name" class="svg-icon" />
          <strong>Nome:</strong> {{ characterData.name }}
        </li>
        <li>
          <img src="assets/star.svg" alt="level" class="svg-icon" /><strong
            >N√≠vel:</strong
          >
          {{ characterData.level }}
        </li>
        <li [ngSwitch]="characterData.vocation">
          <ng-container *ngSwitchCase="'Royal Paladin'">
            <img src="assets/bow.svg" alt="Paladin" class="svg-icon" />
          </ng-container>
          <ng-container *ngSwitchCase="'Paladin'">
            <img src="assets/bow.svg" alt="Paladin" class="svg-icon" />
          </ng-container>

          <ng-container *ngSwitchCase="'Elder Druid'">
            <img src="assets/priest.svg" alt="Druid" class="svg-icon" />
          </ng-container>
          <ng-container *ngSwitchCase="'Druid'">
            <img src="assets/priest.svg" alt="Druid" class="svg-icon" />
          </ng-container>

          <ng-container *ngSwitchCase="'Elite Knight'">
            <img src="assets/swordsman.svg" alt="Knight" class="svg-icon" />
          </ng-container>
          <ng-container *ngSwitchCase="'Knight'">
            <img src="assets/swordsman.svg" alt="Knight" class="svg-icon" />
          </ng-container>

          <ng-container *ngSwitchCase="'Master Sorcerer'">
            <img src="assets/magician.svg" alt="Sorcerer" class="svg-icon" />
          </ng-container>
          <ng-container *ngSwitchCase="'Sorcerer'">
            <img src="assets/magician.svg" alt="Sorcerer" class="svg-icon" />
          </ng-container>
          <!-- Fallback gen√©rico -->
          <ng-container *ngSwitchDefault>
            <img src="assets/question.svg" alt="Unknown" class="svg-icon" />
          </ng-container>

          <strong>Voca√ß√£o:</strong> {{ characterData.vocation }}
        </li>

        <li>
          <img
            src="assets/planet-earth.svg"
            alt="world"
            class="svg-icon"
          /><strong>Mundo:</strong> {{ characterData.world }}
        </li>
        <li>
          <img
            src="assets/armor-svgrepo-com.svg"
            alt="outfit"
            class="svg-icon"
          /><strong>Outfits Desbloqueados:</strong> {{ outfitsPossui.length }} /
          {{ outfitsPossui.length + outfitsNaoPossui.length }}
        </li>
        <li>
          <img src="assets/horse.svg" alt="mounts" class="svg-icon" />
          <strong>Montarias Desbloqueadas:</strong>
          {{ mountsPossui.length }} /
          {{ mountsPossui.length + mountsNaoPossui.length }}
        </li>
        <li>
          <img
            src="assets/success.svg"
            alt="achiviement"
            class="svg-icon"
          /><strong>Conquistas:</strong> {{ allAchievements?.acquired }} /
          {{ allAchievements?.total }}
        </li>
        <li>
          <img src="assets/badge.svg" alt="quest" class="svg-icon" />
          <strong>Achivements Raros:</strong>
          {{ rareAchiviements.length }}
          <span (click)="abrirModalRaros()">
            <img
              src="assets/information.svg"
              alt="informations"
              class="svg-icon"
            />
          </span>
        </li>

        <!-- Tooltip com modal de Quests -->
        <li>
          <img src="assets/quest.svg" alt="quest" class="svg-icon" />
          <strong>Quests Principais:</strong>
          {{ quests.countDone }} / {{ quests.total }}
          <span (click)="abrirModalQuests()">
            <img
              src="assets/information.svg"
              alt="informations"
              class="svg-icon"
          /></span>
        </li>

        <li>
          <img src="assets/gems.svg" alt="quest" class="svg-icon" />
          <strong>Gemas:</strong>
          L: {{ gemCount.lesser }} / R: {{ gemCount.regular }} /
          G: {{ gemCount.greater }}
          <span (click)="abrirModalGems()">
            <img
              src="assets/information.svg"
              alt="informations"
              class="svg-icon"
          /></span>
        </li>
      </ul>

      <div class="exportar-pdf-opcao" (click)="abrirModalExportarPdf()">
        <img src="assets/pdf-file.svg" alt="Salvar em PDF" class="svg-button" />
        <span>Salvar em PDF</span>
      </div>
    </div>

    <!-- Itens a Conquistar (Outfits e Montarias) -->
    <div class="parchment-card" *ngIf="characterData">
      <h2>üó°Ô∏è Cap√≠tulo das Vestes √âpicas üó°Ô∏è</h2>
      <hr />

      <div class="conquista-row-custom">
        <div
          class="conquista-card-custom"
          *ngFor="let outfit of outfitsNaoPossui"
        >
          <div class="conquista-image-container-custom">
            <img
              [src]="outfit.image"
              [alt]="outfit.name"
              class="conquista-image-custom"
            />
          </div>
          <div class="conquista-info-custom">
            <span class="conquista-name-custom">{{ outfit.name }}</span
            ><br />

            <span
              class="missing-details-custom"
              *ngIf="!outfit.base || !outfit.addon1 || !outfit.addon2"
            >
              <ng-container
                *ngIf="!outfit.base && !outfit.addon1 && !outfit.addon2"
              >
                <span class="flavor-text">A jornada nem come√ßou!</span>
              </ng-container>

              <ng-container
                *ngIf="!(!outfit.base && !outfit.addon1 && !outfit.addon2)"
              >
                <ng-container
                  *ngIf="!outfit.addon1 && !outfit.addon2 && outfit.base"
                >
                  <span class="flavor-text"
                    >Os artefatos finais ainda n√£o foram domados...</span
                  >
                  <div class="disclaimer-row">
                    <div class="medieval-disclaimer">
                      <span>‚ùå</span> addon 1
                    </div>
                    <div class="medieval-disclaimer">
                      <span>‚ùå</span> addon 2
                    </div>
                  </div>
                </ng-container>

                <ng-container *ngIf="!outfit.addon1 && outfit.addon2">
                  <span class="flavor-text"
                    >O primeiro selo ainda resiste.</span
                  >
                  <div class="disclaimer-row">
                    <div class="medieval-disclaimer">
                      <span>‚ùå</span> addon 1
                    </div>
                  </div>
                </ng-container>

                <ng-container *ngIf="!outfit.addon2 && outfit.addon1">
                  <span class="flavor-text"
                    >O √∫ltimo fragmento n√£o foi forjado.</span
                  >
                  <div class="disclaimer-row">
                    <div class="medieval-disclaimer">
                      <span>‚ùå</span> addon 2
                    </div>
                  </div>
                </ng-container>

                <ng-container
                  *ngIf="!outfit.base && (outfit.addon1 || outfit.addon2)"
                >
                  <span class="flavor-text"
                    >A alma do traje ainda aguarda seu her√≥i</span
                  >
                </ng-container>
              </ng-container>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="parchment-card" *ngIf="characterData">
      <!-- MONTARIAS A CONQUISTAR -->
      <h2>üê∫ Aliados das Terras Selvagens üê∫</h2>
      <hr />

      <div class="conquista-row-custom">
        <div
          class="conquista-card-custom"
          *ngFor="let mount of mountsNaoPossui"
        >
          <div class="conquista-image-container-custom">
            <img
              [src]="mount.image"
              [alt]="mount.name"
              class="conquista-image-custom"
            />
          </div>
          <div class="conquista-info-custom">
            <span class="conquista-name-custom">{{ mount.name }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="exibirModalExportarPdf">
    <div class="modal-conteudo">
      <h3>Escolha o que deseja exportar:</h3>
      <label
        ><input
          type="radio"
          name="tipoExportacao"
          [(ngModel)]="tipoExportacao"
          value="achievements"
        />
        Achievements</label
      >
      <label
        ><input
          type="radio"
          name="tipoExportacao"
          [(ngModel)]="tipoExportacao"
          value="mounts"
        />
        Montarias</label
      >
      <label
        ><input
          type="radio"
          name="tipoExportacao"
          [(ngModel)]="tipoExportacao"
          value="outfits"
        />
        Outfits</label
      >
      <label
        ><input
          type="radio"
          name="tipoExportacao"
          [(ngModel)]="tipoExportacao"
          value="completo"
        />
        Tudo</label
      >

      <div class="modal-botoes">
        <button (click)="confirmarExportacaoTipo()">Exportar</button>
        <button (click)="fecharModalExportarPdf()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Rare Achievements -->
  <div class="modal-overlay" *ngIf="exibirModalRaros">
    <div class="modal-conteudo">
      <h3 class="modal-titulo">Rare Achievements</h3>

      <div class="grid-3-cols">
        <div
          *ngFor="let nome of objectKeys(rareAchievementsList)"
          [ngClass]="{
            'achivement-possui': possuiAchievementRaro(nome),
            'achivement-nao-possui': !possuiAchievementRaro(nome)
          }"
        >
          {{ rareAchievementsList[nome] }}
        </div>
      </div>
      <div class="modal-botoes">
        <button (click)="fecharModalRaros()">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Quests -->
  <div class="modal-overlay" *ngIf="exibirModalQuests">
    <div class="modal-conteudo">
      <h3 class="modal-titulo">Quests Principais</h3>

      <div class="quests-grid">
        <!-- Utilit√°rias -->
        <div>
          <h4>Utilit√°rias</h4>
          <ul>
            <li
              *ngFor="let nome of questsPorCategoria['utilitary']"
              [ngClass]="{
                concluida: possuiQuest(nome) === true,
                incompleta: possuiQuest(nome) === false
              }"
            >
              {{ questsModel[nome] }}
            </li>
          </ul>
        </div>

        <!-- Acesso -->
        <div>
          <h4>Acesso</h4>
          <ul>
            <li
              *ngFor="let nome of questsPorCategoria['access']"
              [ngClass]="{
                concluida: possuiQuest(nome) === true,
                incompleta: possuiQuest(nome) === false
              }"
            >
              {{ questsModel[nome] }}
            </li>
          </ul>
        </div>

        <!-- Bosses -->
        <div>
          <h4>Bosses</h4>
          <ul>
            <li
              *ngFor="let nome of questsPorCategoria['bosses']"
              [ngClass]="{
                concluida: possuiQuest(nome) === true,
                incompleta: possuiQuest(nome) === false
              }"
            >
              {{ questsModel[nome] }}
            </li>
          </ul>
        </div>
      </div>

      <div class="modal-botoes">
        <button (click)="fecharModalQuests()">Fechar</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="exibirModalGems">
    <div class="modal-conteudo">
      <h3 class="modal-titulo">Greater Gems</h3>
  
        <div class="space-elements" *ngFor="let gem of gemsPaginadas">
          {{ gem }}
        </div>
  
      <div class="paginacao-gems">
        <button
          *ngIf="paginaGemsAtual > 1"
          class="button-medieval"
          (click)="paginaAnteriorGems()"
        >
          Anterior
        </button>
      
        <span *ngIf="totalPaginasGems > 1" class="pagina-label">
          P√°gina {{ paginaGemsAtual }} de {{ totalPaginasGems }}
        </span>
      
        <button
          *ngIf="paginaGemsAtual < totalPaginasGems"
          class="button-medieval"
          (click)="proximaPaginaGems()"
        >
          Pr√≥xima
        </button>
      </div>
      
    
      <div class="modal-botoes">
        <button (click)="fecharModalGems()">Fechar</button>
      </div>
    </div>
  </div>
  
</div>
