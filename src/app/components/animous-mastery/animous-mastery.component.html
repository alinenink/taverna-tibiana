<!-- Container geral -->
<div class="svg-loader-overlay" *ngIf="carregando">
  <div class="svg-loader">
    <svg
      fill="#000000"
      height="200px"
      width="200px"
      version="1.1"
      id="Capa_1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 452.022 452.022"
      xml:space="preserve"
    >
      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
      <g
        id="SVGRepo_tracerCarrier"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></g>
      <g id="SVGRepo_iconCarrier">
        <path
          d="M440.761,380.351l-50.512-50.512l24.481-24.481c3.905-3.905,3.905-10.237,0-14.143c-3.905-3.904-10.237-3.904-14.143,0 l-9.494,9.494l-42.368-42.368c6.562-23.401,9.894-47.59,9.894-72l-0.001-153.69c0-4.777-3.379-8.887-8.065-9.811 c-113.629-22.402-228.859-22.402-342.488,0C3.379,23.764,0,27.875,0,32.652v153.69c0,55.105,16.721,108.08,48.356,153.2 c31.635,45.119,75.739,78.897,127.545,97.681c1.101,0.399,2.255,0.599,3.409,0.599c1.154,0,2.308-0.2,3.41-0.599 c40.392-14.651,76.722-38.923,105.694-70.5l18.334,18.334l-9.494,9.494c-3.905,3.905-3.905,10.237,0,14.143 c1.953,1.953,4.512,2.929,7.071,2.929c2.559,0,5.119-0.977,7.071-2.929l24.481-24.481l50.512,50.512 c7.262,7.261,16.917,11.26,27.187,11.26s19.924-3.999,27.186-11.26c7.262-7.262,11.261-16.917,11.261-27.186 C452.022,397.268,448.023,387.613,440.761,380.351z M359.946,331.858l-3.954,3.954L162.901,142.72l45.434,3.515l168.616,168.617 L359.946,331.858z M303.621,186.342c0,8.507-0.522,16.987-1.523,25.371l-82.234-82.234c-1.687-1.687-3.921-2.715-6.3-2.899 l-76.09-5.886c-2.916-0.229-5.777,0.833-7.842,2.899c-2.065,2.065-3.124,4.93-2.899,7.842l5.886,76.09 c0.184,2.379,1.212,4.613,2.899,6.3L249.48,327.788c-19.637,21.998-43.181,39.294-70.167,51.487 c-34.45-15.596-64.093-40.179-85.924-71.304C68.275,272.143,55,230.084,55,186.342l0-110.473c82.527-15.788,166.093-15.788,248.62,0 V186.342z M179.309,417.156c-46.45-17.606-86.009-48.352-114.577-89.097C35.468,286.322,20,237.317,20,186.342l0-145.43 c105.764-19.83,212.856-19.83,318.62,0v145.43c0,18.764-2.131,37.386-6.331,55.563l-12.648-12.648 c2.637-14.044,3.979-28.452,3.979-42.915l-0.001-118.69c0-4.753-3.346-8.849-8.003-9.798c-90.445-18.438-182.167-18.438-272.614,0 C38.345,58.802,35,62.899,35,67.652v118.69c0,47.872,14.527,93.9,42.013,133.112c24.797,35.354,58.809,62.997,98.359,79.939 c1.257,0.539,2.597,0.808,3.938,0.808c1.34,0,2.68-0.269,3.937-0.808c31.01-13.282,57.997-32.593,80.394-57.444l10.618,10.618 C248.179,381.194,215.58,403.39,179.309,417.156z M152.273,202.297l-3.514-45.434l193.091,193.091l-20.96,20.959L152.273,202.297z M376.107,343.981l6.336,6.336l-15.345,36.829l-17.078-17.078L376.107,343.981z M382.392,402.44l15.345-36.829l11.178,11.178 l-15.345,36.829L382.392,402.44z M426.619,420.58L426.619,420.58c-3.483,3.484-8.116,5.403-13.043,5.403 c-1.141,0-2.262-0.114-3.361-0.315l13.994-33.585l2.41,2.41c3.484,3.484,5.403,8.116,5.403,13.043S430.103,417.096,426.619,420.58z"
        ></path>
      </g>
    </svg>
  </div>
</div>

<div class="parchment-background">
  <div class="consulta-layout">
    <h1 class="tavernatibiana-title">Biblioteca Animous</h1>

    <div *ngIf="service.toastMessage()" class="toast-medieval">
      {{ service.toastMessage() }}
    </div>

    <!-- Disclaimer Medieval -->
    <div class="parchment-card medieval-disclaimer">
      <button class="voltar-button-card" [routerLink]="'/home'">Voltar</button>
      <div style="display: flex; align-items: center; gap: 0.3rem; margin-bottom: 0.5rem;">
        <img
          src="assets/spellbook.svg"
          alt="Criatura"
          class="svg-icon intro-icon"
        />
        <strong class="medieval-text"
          >Bem-vindo à Biblioteca de Animous Masteries, aventureiro!</strong
        >
      </div>
      <p class="medieval-intro">
        Aqui, na taverna, teus feitos são registrados com honra! Marque os
        <strong>Animous Masteries</strong> que já conquistaste em tuas jornadas
        e mantenha viva a lenda do teu personagem.<br />
        Agora, seus registros são salvos automaticamente na nuvem. Se você já
        possuía um arquivo JSON antigo, basta fazer o upload para restaurar seus
        feitos.<br />
        Sempre que quiser salvar suas conquistas atuais, clique em
        <strong>Salvar</strong>.<br />
        Que teus passos sejam firmes e tua lista, lendária!
      </p>
      <!-- Filtros -->
      <div class="parchment-card filtro-container">
        Use os campos abaixo para localizar criaturas por nome, classe ou nível
        de dificuldade. Quanto mais preciso, mais certeiro será teu resultado!

        <form class="filtro-form" (submit)="buscar($event)">
          <input
            type="text"
            [(ngModel)]="filtros.nome"
            name="nome"
            placeholder="Criatura"
            class="input-medieval"
            (input)="filtros.nome.length >= 4 && buscar()"
          />
          <input
            type="text"
            [(ngModel)]="filtros.classe"
            name="classe"
            placeholder="Classe"
            class="input-medieval"
          />
          <select
            [(ngModel)]="filtros.dificuldade"
            name="dificuldade"
            class="select-medieval"
          >
            <option value="">Todas dificuldades</option>
            <option value="Trivial">Trivial</option>
            <option value="Harmless">Harmless</option>
            <option value="Easy">Easy</option>
            <option value="Medium">Medium</option>
            <option value="Hard">Hard</option>
            <option value="Challenging">Challenging</option>
            <option value="Rare">Rare</option>
          </select>

          <button type="submit">Buscar</button>
        </form>

        <!-- Barra de ações melhorada -->
        <div class="acoes-icons acoes-centralizadas">
          <span class="acao-item" (click)="limparSelecao()">
            <img
              src="assets/eraser.svg"
              alt="Limpar Seleção"
              class="svg-button"
            />
            <span>Limpar seleção</span>
          </span>
          <span class="acao-item" (click)="abrirModalExportar()">
            <img
              src="assets/pdf-file.svg"
              alt="Exportar PDF"
              class="svg-button"
            />
            <span>Exportar PDF</span>
          </span>
          <span class="acao-item" (click)="salvarSelecionados()">
            <img src="assets/floppy-disk.svg" alt="Salvar" class="svg-button" />
            <span>Salvar</span>
          </span>
          <label for="upload-json" class="acao-item svg-label">
            <img
              src="assets/document.svg"
              alt="Importar JSON"
              class="svg-button"
            />
            <span>Importar JSON</span>
          </label>
          <input
            type="file"
            id="upload-json"
            accept="application/json"
            style="display: none"
            (change)="onUpload($event)"
          />
        </div>
      </div>

      <!-- Indicador total -->
      <div style="margin-bottom: 1rem">
        <strong>{{ service.selecionados().length }}</strong> selecionados de
        {{ service.totalResultados() }} monstros
      </div>

      <!-- Tabela para desktop -->
      <div class="tabela-wrapper" id="tabela-desktop">
        <table *ngIf="!isMobile" class="tabela-pergaminho">
          <thead>
            <tr>
              <th></th>
              <th (click)="ordenarPor('name')" class="ordenavel">
                Criatura
                <span *ngIf="ordenacoes['name']">&#x25B2;</span>
                <span *ngIf="!ordenacoes['name']">&#x25BC;</span>
              </th>
              <th (click)="ordenarPor('difficulty')" class="ordenavel">
                Dificuldade
                <span *ngIf="ordenacoes['difficulty']">&#x25B2;</span>
                <span *ngIf="!ordenacoes['difficulty']">&#x25BC;</span>
              </th>
              <th (click)="ordenarPor('class.name')" class="ordenavel">
                Classe
                <span *ngIf="ordenacoes['class.name']">&#x25B2;</span>
                <span *ngIf="!ordenacoes['class.name']">&#x25BC;</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of service.dados()">
              <td>
                <input
                  type="checkbox"
                  [checked]="isSelecionado(item.id)"
                  (change)="selecionar($event, item)"
                />
              </td>
              <td>{{ item.name }}</td>
              <td>{{ item.difficulty }}</td>
              <td>{{ item.class.name }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Cards para mobile -->
      <div *ngIf="isMobile" id="cards-mobile" class="cards-mobile">
        <div
          class="mobile-card"
          *ngFor="let item of service.dados()"
          [class.selecionado]="isSelecionado(item.id)"
          (click)="toggleSelecao(item)"
        >
          <div class="card-title">{{ item.name }}</div>
          <div class="card-info">
            <strong>Dificuldade:</strong> {{ item.difficulty }}
          </div>
          <div class="card-info">
            <strong>Classe:</strong> {{ item.class.name }}
          </div>
        </div>
      </div>

      <!-- Paginação -->
      <div class="botoes-paginacao" *ngIf="service.totalPaginas() > 1">
        <button *ngIf="service.paginaAtual() > 1" (click)="paginaAnterior()">
          Anterior
        </button>
        <button
          *ngIf="service.paginaAtual() < service.totalPaginas()"
          (click)="proximaPagina()"
        >
          Próximo
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="exibirModalExportar">
  <div class="modal-conteudo">
    <h3 class="modal-titulo">Exportar PDF</h3>
    <div class="modal-opcoes">
      <label class="modal-checkbox">
        <input type="checkbox" [(ngModel)]="ordenarPorDificuldade" /> Ordenar
        por dificuldade
      </label>
      <label class="modal-checkbox">
        <input type="checkbox" [(ngModel)]="ordenarPorAlfabetica" /> Ordenar por
        ordem alfabética
      </label>
    </div>
    <div class="modal-botoes">
      <button (click)="confirmarExportacaoPdf()">Exportar</button>
      <button (click)="fecharModalExportar()">Cancelar</button>
    </div>
  </div>
</div>

<!-- Modal Visitante -->
<div class="modal-overlay" *ngIf="exibirModalVisitante">
  <div class="modal-conteudo" (click)="$event.stopPropagation()">
    <h3 class="modal-titulo">
      <img src="assets/beer-mug.svg" alt="Taverna" class="svg-icon" style="width: 24px; height: 24px; margin-right: 8px;" />
      Atenção, aventureiro!
    </h3>
    <div class="modal-opcoes">
      <p style="font-size: 1.1rem; color: #7a5a2f; text-align: center; margin: 1.2em 0;">
        Percebi que você está tentando salvar seus pergaminhos lendários como visitante! Se você quer desfrutar de todas as funcionalidades da Taverna, é preciso se registrar!
      </p>
    </div>
    <div class="modal-botoes">
      <button type="button" class="button-medieval" (click)="irParaRegister()">
        Me registrar agora
      </button>
      <button type="button" class="button-medieval" (click)="fecharModalVisitante()">
        Cancelar
      </button>
    </div>
  </div>
</div>
