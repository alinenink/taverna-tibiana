<div class="svg-loader-overlay" *ngIf="carregando">
  <div class="svg-loader">
    <svg
      fill="#000000"
      height="200px"
      width="200px"
      version="1.1"
      id="Capa_1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 452.022 452.022"
      xml:space="preserve"
    >
      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
      <g
        id="SVGRepo_tracerCarrier"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></g>
      <g id="SVGRepo_iconCarrier">
        <path
          d="M440.761,380.351l-50.512-50.512l24.481-24.481c3.905-3.905,3.905-10.237,0-14.143c-3.905-3.904-10.237-3.904-14.143,0 l-9.494,9.494l-42.368-42.368c6.562-23.401,9.894-47.59,9.894-72l-0.001-153.69c0-4.777-3.379-8.887-8.065-9.811 c-113.629-22.402-228.859-22.402-342.488,0C3.379,23.764,0,27.875,0,32.652v153.69c0,55.105,16.721,108.08,48.356,153.2 c31.635,45.119,75.739,78.897,127.545,97.681c1.101,0.399,2.255,0.599,3.409,0.599c1.154,0,2.308-0.2,3.41-0.599 c40.392-14.651,76.722-38.923,105.694-70.5l18.334,18.334l-9.494,9.494c-3.905,3.905-3.905,10.237,0,14.143 c1.953,1.953,4.512,2.929,7.071,2.929c2.559,0,5.119-0.977,7.071-2.929l24.481-24.481l50.512,50.512 c7.262,7.261,16.917,11.26,27.187,11.26s19.924-3.999,27.186-11.26c7.262-7.262,11.261-16.917,11.261-27.186 C452.022,397.268,448.023,387.613,440.761,380.351z M359.946,331.858l-3.954,3.954L162.901,142.72l45.434,3.515l168.616,168.617 L359.946,331.858z M303.621,186.342c0,8.507-0.522,16.987-1.523,25.371l-82.234-82.234c-1.687-1.687-3.921-2.715-6.3-2.899 l-76.09-5.886c-2.916-0.229-5.777,0.833-7.842,2.899c-2.065,2.065-3.124,4.93-2.899,7.842l5.886,76.09 c0.184,2.379,1.212,4.613,2.899,6.3L249.48,327.788c-19.637,21.998-43.181,39.294-70.167,51.487 c-34.45-15.596-64.093-40.179-85.924-71.304C68.275,272.143,55,230.084,55,186.342l0-110.473c82.527-15.788,166.093-15.788,248.62,0 V186.342z M179.309,417.156c-46.45-17.606-86.009-48.352-114.577-89.097C35.468,286.322,20,237.317,20,186.342l0-145.43 c105.764-19.83,212.856-19.83,318.62,0v145.43c0,18.764-2.131,37.386-6.331,55.563l-12.648-12.648 c2.637-14.044,3.979-28.452,3.979-42.915l-0.001-118.69c0-4.753-3.346-8.849-8.003-9.798c-90.445-18.438-182.167-18.438-272.614,0 C38.345,58.802,35,62.899,35,67.652v118.69c0,47.872,14.527,93.9,42.013,133.112c24.797,35.354,58.809,62.997,98.359,79.939 c1.257,0.539,2.597,0.808,3.938,0.808c1.34,0,2.68-0.269,3.937-0.808c31.01-13.282,57.997-32.593,80.394-57.444l10.618,10.618 C248.179,381.194,215.58,403.39,179.309,417.156z M152.273,202.297l-3.514-45.434l193.091,193.091l-20.96,20.959L152.273,202.297z M376.107,343.981l6.336,6.336l-15.345,36.829l-17.078-17.078L376.107,343.981z M382.392,402.44l15.345-36.829l11.178,11.178 l-15.345,36.829L382.392,402.44z M426.619,420.58L426.619,420.58c-3.483,3.484-8.116,5.403-13.043,5.403 c-1.141,0-2.262-0.114-3.361-0.315l13.994-33.585l2.41,2.41c3.484,3.484,5.403,8.116,5.403,13.043S430.103,417.096,426.619,420.58z"
        ></path>
      </g>
    </svg>
  </div>
</div>

<div class="parchment-background">
  <div class="consulta-layout">
    <h1 class="tavernatibiana-title">Registro do Aventureiro</h1>

    <!-- Formulário de Registro -->
    <form
      *ngIf="!showVerification"
      class="parchment-card"
      [formGroup]="registerForm"
      (ngSubmit)="onSubmit()"
    >
      <h2>Registro do Aventureiro</h2>
      <hr />
      
      <!-- Mensagem do taberneiro -->
      <div class="medieval-disclaimer">
        <p><img src="assets/icons-svg/beer-mug.svg" alt="Criatura" class="svg-icon" />
 <strong>Saudações, nobre aventureiro!</strong></p>
        <p>
          Para registrar-se em nossa taverna, preencha o pergaminho abaixo com
          seus dados mágicos.<br />
          <strong>IMPORTANTE:</strong>
          <span style="color: #b97a1a">
            NÃO use a mesma senha da sua conta do Tibia!</span
          ><br />
          A senha do portal deve ter pelo menos 8 caracteres, incluindo letras e
          números.<br />
          E <strong>lembre-se:</strong> aqui, sua privacidade é respeitada como
          a receita do melhor hidromel!
        </p>
      </div>

      <div *ngIf="erro" class="login-error">{{ erro }}</div>

      <!-- Email Field -->
      <div class="input-icon-group">
                  <img src="assets/icons-svg/id-card.svg" alt="Email" class="svg-icon" />
        <input
          id="email"
          class="input-medieval"
          type="email"
          formControlName="email"
          placeholder="Email mágico"
          required
        />
      </div>
      <div
        *ngIf="
          registerForm.get('email')?.invalid &&
          registerForm.get('email')?.touched
        "
        class="login-error"
      >
        <span *ngIf="registerForm.get('email')?.errors?.['required']"
          >Email é obrigatório</span
        >
        <span *ngIf="registerForm.get('email')?.errors?.['email']"
          >Formato de email inválido</span
        >
        <span *ngIf="registerForm.get('email')?.errors?.['invalidDomain']"
          >Domínio de email não permitido</span
        >
      </div>

      <!-- Character Name Field -->
      <div class="input-icon-group">
                  <img src="assets/icons-svg/swordsman.svg" alt="Personagem" class="svg-icon" />
        <input
          id="char"
          class="input-medieval"
          type="text"
          formControlName="char"
          placeholder="Nome do personagem no Tibia"
          required
        />
      </div>
      <div
        *ngIf="
          registerForm.get('char')?.invalid &&
          registerForm.get('char')?.touched
        "
        class="login-error"
      >
        <span *ngIf="registerForm.get('char')?.errors?.['required']"
          >Nome do personagem é obrigatório</span
        >
      </div>

      <!-- Password Field -->
      <div class="input-icon-group">
                  <img src="assets/icons-svg/key-skills.svg" alt="Senha" class="svg-icon" />
        <input
          id="password"
          class="input-medieval"
          type="password"
          formControlName="password"
          placeholder="Senha do portal (mín. 8 caracteres)"
          required
        />
      </div>
      <div
        *ngIf="
          registerForm.get('password')?.invalid &&
          registerForm.get('password')?.touched
        "
        class="login-error"
      >
        <span *ngIf="registerForm.get('password')?.errors?.['required']"
          >Senha é obrigatória</span
        >
        <span *ngIf="registerForm.get('password')?.errors?.['minlength']"
          >Senha deve ter pelo menos 8 caracteres</span
        >
        <span *ngIf="registerForm.get('password')?.errors?.['pattern']"
          >Senha deve conter letras e números</span
        >
      </div>

      <!-- Confirm Password Field -->
      <div class="input-icon-group">
        <img
          src="assets/icons-svg/key-skills.svg"
          alt="Confirmar Senha"
          class="svg-icon"
        />
        <input
          id="confirmPassword"
          class="input-medieval"
          type="password"
          formControlName="confirmPassword"
          placeholder="Confirmar senha"
          required
        />
      </div>
      <div
        *ngIf="
          registerForm.get('confirmPassword')?.invalid &&
          registerForm.get('confirmPassword')?.touched
        "
        class="login-error"
      >
        <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required']"
          >Confirmação de senha é obrigatória</span
        >
        <span
          *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch']"
          >Senhas não coincidem</span
        >
      </div>

      <!-- Terms and Conditions -->
      <div class="terms-section">
        <div class="terms-checkbox">
          <input
            type="checkbox"
            id="acceptTerms"
            formControlName="acceptTerms"
          />
          <label for="acceptTerms">
            Li e aceito os
            <button
            style="margin-top: 0 !important;"
              type="button"
              class="medieval-link"
              (click)="openTermsModal()"
            >
              Termos de Uso e Política de Privacidade
            </button>
          </label>
        </div>
        <div
          *ngIf="registerForm.get('acceptTerms')?.invalid && registerForm.get('acceptTerms')?.touched"
          class="login-error"
        >
          Você deve aceitar os termos para se registrar
        </div>
      </div>

      <!-- Submit Button -->
      <button
        class="button-medieval"
        type="submit"
        [disabled]="registerForm.invalid || carregando"
      >
        <span *ngIf="!carregando">Alistar-se na Guilda</span>
        <span *ngIf="carregando">Registrando...</span>
      </button>

              <!-- Login Links -->
        <div class="login-links">
          <button class="medieval-link" (click)="goToLogin()">Já tens uma conta? Entrar na Taverna</button>
        </div>

    </form>

    <!-- Formulário de Validação -->
    <form
      *ngIf="showVerification"
      class="parchment-card"
      [formGroup]="verificationForm"
      (ngSubmit)="onVerifyCode()"
    >
      <h2>Validação do Email</h2>
      <hr />
      
      <!-- Mensagem da taberneira -->
      <div class="medieval-disclaimer">
        <p><img src="assets/icons-svg/beer-mug.svg" alt="Criatura" class="svg-icon" />
 <strong>Excelente, aventureiro!</strong></p>
        <p>
          Seu registro foi realizado com sucesso! Agora, para completar sua entrada
          em nossa guilda, precisamos que você valide seu email mágico.<br />
          <strong>Verifique sua caixa de entrada</strong> em 
          <span style="color: #b97a1a">{{ registeredEmail }}</span><br />
          e insira o código de 6 dígitos que enviamos para você.<br />
          <em>Se não encontrar o email, verifique também a pasta de spam!</em>
        </p>
      </div>

      <!-- Código de Verificação Field -->
      <div *ngIf="verificacaoErro" class="login-error">{{ verificacaoErro }}</div>
      <div class="input-icon-group">
        <img src="assets/icons-svg/key-skills.svg" alt="Código" class="svg-icon" />
        <input
          id="code"
          class="input-medieval"
          type="text"
          formControlName="code"
          placeholder="Código de verificação (6 dígitos)"
          required
          maxlength="6"
          pattern="[0-9]{6}"
        />
      </div>
      <div
        *ngIf="
          verificationForm.get('code')?.invalid &&
          verificationForm.get('code')?.touched
        "
        class="login-error"
      >
        <span *ngIf="verificationForm.get('code')?.errors?.['required']"
          >Código é obrigatório</span
        >
        <span *ngIf="verificationForm.get('code')?.errors?.['minlength'] || verificationForm.get('code')?.errors?.['maxlength']"
          >Código deve ter exatamente 6 dígitos</span
        >
      </div>

      <!-- Submit Button -->
      <button
        class="button-medieval"
        type="submit"
        [disabled]="verificationForm.invalid || carregando"
      >
        <span *ngIf="!carregando">Validar Código</span>
        <span *ngIf="carregando">Validando...</span>
      </button>

      <!-- Back Button -->
      <div class="login-links">
        <button
          type="button"
          class="medieval-link"
          (click)="backToRegister()"
        >
          ← Voltar ao Registro
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Terms Modal -->
<div class="modal-overlay" *ngIf="showTermsModal" (click)="closeTermsModal()">
  <div class="modal-conteudo" (click)="$event.stopPropagation()">
    <h3 class="modal-titulo">📋 Termos de Uso e Política de Privacidade</h3>

    <div class="modal-opcoes">
      <h4>🔒 Política de Privacidade (LGPD)</h4>
      <p>
        Em conformidade com a Lei Geral de Proteção de Dados (LGPD - Lei nº
        13.709/2018), informamos que:
      </p>

      <ul>
        <li>
          <strong>Coleta de Dados:</strong> Coletamos apenas informações
          necessárias para o funcionamento do portal (email, nome do personagem
          e senha do portal).
        </li>
        <li>
          <strong>Uso dos Dados:</strong> Seus dados são utilizados
          exclusivamente para autenticação e funcionalidades do portal Animous
          Mastery.
        </li>
        <li>
          <strong>Segurança:</strong> Implementamos medidas técnicas e
          organizacionais para proteger seus dados pessoais.
        </li>
        <li>
          <strong>Não Compartilhamento:</strong> Não compartilhamos, vendemos ou
          alugamos suas informações pessoais a terceiros.
        </li>
        <li>
          <strong>Seus Direitos:</strong> Você tem direito de acessar, corrigir,
          excluir ou portar seus dados pessoais.
        </li>
      </ul>

      <h4>⚠️ Declarações Importantes</h4>
      <ul>
        <li>
          <strong>Não Malicioso:</strong> Este portal não possui fins maliciosos
          e não coleta dados para prejudicar usuários.
        </li>
        <li>
          <strong>Sem Acesso ao Tibia:</strong> Não temos e não tentaremos obter
          acesso à sua conta do Tibia ou informações relacionadas ao jogo.
        </li>
        <li>
          <strong>Independência:</strong> Este é um portal independente, não
          afiliado oficialmente ao Tibia ou CipSoft.
        </li>
        <li>
          <strong>Responsabilidade:</strong> O usuário é responsável por manter
          a segurança de suas credenciais.
        </li>
      </ul>

      <h4>📜 Termos de Uso</h4>
      <ul>
        <li>O uso deste portal é voluntário e gratuito.</li>
        <li>
          É proibido o uso para fins ilegais ou que violem os direitos de
          terceiros.
        </li>
        <li>
          Reservamo-nos o direito de modificar estes termos a qualquer momento.
        </li>
        <li>
          O uso continuado do portal após mudanças nos termos constitui
          aceitação das modificações.
        </li>
      </ul>

      <p class="contact-info">
        Para dúvidas sobre esta política, entre em contato através do portal.
      </p>
    </div>

    <div class="modal-botoes">
      <button type="button" class="button-medieval" (click)="acceptTerms()">
        Aceitar Termos
      </button>
      <button type="button" class="button-medieval" (click)="closeTermsModal()">
        Fechar
      </button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal-overlay" *ngIf="showSuccessModal">
  <div class="modal-conteudo" (click)="$event.stopPropagation()">
    <h3 class="modal-titulo">🎉 Código Validado com Sucesso!</h3>

    <div class="modal-opcoes">
      <div style="text-align: center; margin: 2rem 0;">
        <p style="font-size: 1.2rem; margin-bottom: 1rem;">
          <strong>Parabéns, aventureiro!</strong> 🍺
        </p>
        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">
          Seu registro foi completado com sucesso! Agora você é um membro oficial da nossa taverna.
        </p>
        <p style="font-size: 1rem; color: #b97a1a; margin-bottom: 2rem;">
          Estamos te teleportando para a tela de login em <strong>{{ teleportTimer }}</strong> segundos...
        </p>
      </div>
    </div>

    <div class="modal-botoes">
      <button type="button" class="button-medieval" (click)="teleportNow()">
        Teleportar Agora
      </button>
    </div>
  </div>
</div>
